generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String          @id @default(uuid())
  email           String          @unique
  passwordHash    String?
  oauthProvider   String?
  oauthId         String?
  role            Role
  name            String
  locale          String          @default("fr")
  createdAt       DateTime        @default(now())
  clubId          String?
  assessments     Assessment[]    @relation("ScoutAssessments")
  players         PlayerProfile[]
  reports         Report[]
  followedPlayers PlayerFollow[]
  managedClub     Club?           @relation("ClubScouts", fields: [clubId], references: [id])
  Club_ClubToUser Club[]          @relation("ClubToUser")
}

model Club {
  id               String         @id @default(uuid())
  name             String
  country          String
  tier             String?
  contactEmail     String
  notes            String?
  createdAt        DateTime       @default(now())
  subscriptionTier String         @default("FREE")
  shortlists       Shortlist[]
  trialRequests    TrialRequest[]
  scouts           User[]         @relation("ClubScouts")
  User_ClubToUser  User[]         @relation("ClubToUser")
}

model PlayerProfile {
  id            String            @id @default(uuid())
  firstName     String
  lastName      String
  birthDate     DateTime
  nationality   String
  foot          String
  heightCm      Int?
  weightKg      Int?
  tags          String[]
  publicOptIn   Boolean           @default(false)
  photoUrl      String?
  videoUrls     String[]
  userId        String?
  createdAt     DateTime          @default(now())
  positions     String[]
  assessments   Assessment[]
  user          User?             @relation(fields: [userId], references: [id])
  reports       Report[]
  shortlists    ShortlistPlayer[]
  trialRequests TrialRequest[]
  followers     PlayerFollow[]
}

model Assessment {
  id        String           @id @default(uuid())
  playerId  String
  scoutId   String
  date      DateTime
  location  String?
  notes     String?
  status    AssessmentStatus @default(PLANNED)
  videos    String[]
  createdAt DateTime         @default(now())
  player    PlayerProfile    @relation(fields: [playerId], references: [id])
  scout     User             @relation("ScoutAssessments", fields: [scoutId], references: [id])
  metrics   Metric[]
  report    Report?
}

model Metric {
  id           String     @id @default(uuid())
  assessmentId String
  key          String
  value        Float
  unit         String
  assessment   Assessment @relation(fields: [assessmentId], references: [id])
}

model Report {
  id           String        @id @default(uuid())
  playerId     String
  assessmentId String?       @unique
  summary      String
  strengths    String[]
  weaknesses   String[]
  clubFit      String[]
  pdfUrl       String?
  createdAt    DateTime      @default(now())
  authorId     String?
  assessment   Assessment?   @relation(fields: [assessmentId], references: [id])
  author       User?         @relation(fields: [authorId], references: [id])
  player       PlayerProfile @relation(fields: [playerId], references: [id])
}

model TrialRequest {
  id        String        @id @default(uuid())
  clubId    String
  playerId  String
  message   String
  status    TrialStatus   @default(PENDING)
  createdAt DateTime      @default(now())
  club      Club          @relation(fields: [clubId], references: [id])
  player    PlayerProfile @relation(fields: [playerId], references: [id])
}

model Shortlist {
  id        String            @id @default(uuid())
  name      String
  clubId    String
  createdAt DateTime          @default(now())
  club      Club              @relation(fields: [clubId], references: [id])
  players   ShortlistPlayer[]
}

model ShortlistPlayer {
  shortlistId String
  playerId    String
  createdAt   DateTime      @default(now())
  player      PlayerProfile @relation(fields: [playerId], references: [id])
  shortlist   Shortlist     @relation(fields: [shortlistId], references: [id])

  @@id([shortlistId, playerId])
}

model PlayerFollow {
  id        String        @id @default(uuid())
  scoutId   String
  playerId  String
  notes     String?
  createdAt DateTime      @default(now())
  scout     User          @relation(fields: [scoutId], references: [id])
  player    PlayerProfile @relation(fields: [playerId], references: [id])

  @@unique([scoutId, playerId])
}

enum Role {
  ADMIN
  SCOUT
  CLUB
  PLAYER
}

enum AssessmentStatus {
  PLANNED
  IN_REVIEW
  DONE
}

enum TrialStatus {
  PENDING
  APPROVED
  DECLINED
}
